kind: pipeline
type: kubernetes
name: Docker Test

steps:
- name: build
  image: gautada/builder:v1.21.4_v3.2.3
  privileged: true
  environment:
    DOCKER_USERNAME:
      from_secret: hub.docker.io-username
    DOCKER_PASSWORD:
      from_secret: hub.docker.io-password
  commands:
  - echo $DOCKER_USERNAME
  - sleep 5 # give docker enough time to start
  - buildah bud --build-arg BRANCH=v3.14.1 --tag localhost/crond:dev -f Containerfile
  - buildah login --username=$DOCKER_USER --password=$DOCKER_PASSWORD docker.io
  # buildah tag localhost/crond:dev docker.io/gautada/crond:v3.14.1
  - buildah push localhost/crond.dev docker://docker.io/gautada/crond:v3.14.1
  - buildah images
  

